<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Prevent pinch zoom and ensure full-width scaling on mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>run prachi run</title>
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display|Montserrat" rel="stylesheet" />
  <style>
    /* Root Colors */
    :root {
      --primary: #FADCD9;   /* Muted blush pink */
      --neutral: #FFF9F4;   /* Soft cream */
      --contrast: #FFFFFF;  /* Crisp white */
      --accent: #D4AF37;    /* Subtle gold */
      --text: #333;         /* Dark text */
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--neutral);
      font-family: 'Montserrat', sans-serif;
      color: var(--text);
      overflow-x: hidden; /* no horizontal scroll */
      /* We'll allow vertical scroll if needed */
    }

    h1, h2 {
      font-family: 'Playfair Display', serif;
      color: var(--primary);
      margin: 0;
    }

    /* Instruction Screen (Full overlay) */
    #instructionScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: var(--neutral);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 999;
      padding: 20px;
      box-sizing: border-box;
    }
    #instructionScreen p {
      font-size: 1rem;
      margin-bottom: 20px;
      max-width: 600px;
      line-height: 1.4;
    }

    button {
      background: var(--primary);
      border: 1px solid var(--accent);
      color: var(--contrast);
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      transition: transform 0.2s ease;
    }
    button:hover {
      transform: scale(1.05);
    }

    /* Main Game Container */
    #gameContainer {
      display: none; /* shown after clicking Start */
      width: 100%;
      min-height: 100vh;
      box-sizing: border-box;
    }

    /* A “box” for the game, but fully responsive */
    #gameBox {
      width: 100%;
      max-width: 800px;  /* slightly bigger so it's not tiny on mobile */
      margin: 0 auto;
      background: var(--contrast);
      border: 2px solid var(--accent);
      border-radius: 10px;
      padding: 10px;
      box-sizing: border-box;
      position: relative;
    }

    /* Score & progress bar container */
    #scoreBoard {
      font-size: 1rem;
      margin: 5px 0;
    }
    #progressBar {
      width: 100%;
      height: 6px;
      background: #eee;
      border-radius: 3px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }
    #progressFill {
      width: 0%;
      height: 100%;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    /* The canvas: fully responsive. 
       We fix the internal size, but scale visually. */
    #gameCanvas {
      display: block;
      width: 100%;     /* stretch to box width */
      height: auto;    /* maintain aspect ratio */
      border: 1px solid #ccc;
      background: var(--neutral);
    }

    /* The jump button goes BELOW the box on mobile. We'll just place it 
       in HTML after the box and hide it if not mobile. */
    #mobileJumpWrapper {
      display: none; /* default hidden, shown only if mobile */
      text-align: center;
      margin-top: 10px;
    }
    #jumpButton {
      padding: 15px 25px;
      font-size: 1rem;
      border-radius: 8px;
    }

    /* Popup overlay */
    #popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #popupContent {
      background: var(--contrast);
      padding: 20px;
      border: 2px solid var(--primary);
      border-radius: 10px;
      text-align: center;
      max-width: 80%;
      box-sizing: border-box;
    }
    #popupContent p {
      margin-bottom: 15px;
      font-size: 1rem;
      line-height: 1.4;
    }

    /* End Credits Screen */
    #credits {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      color: #fff;
      display: none;
      overflow: hidden;
      z-index: 2000;
    }
    #creditsContent {
      position: absolute;
      width: 100%;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      line-height: 2;
      animation: scrollCredits 20s linear forwards;
      top: 100%;
    }
    @keyframes scrollCredits {
      from { top: 100%; }
      to { top: -200%; }
    }

    /* Prevent text selection highlighting while playing */
    body, #gameCanvas {
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
  </style>
</head>
<body>
  <!-- Instruction Screen -->
  <div id="instructionScreen">
    <h1>run prachi run</h1>
    <p>Hey Prachi, it's time to conquer every obstacle in your path.  
       Tap “Start” to begin, and use the jump button (or spacebar on desktop) to leap over obstacles.  
       Keep your focus and enjoy the run!</p>
    <button id="startButton">Start</button>
  </div>

  <!-- Main Game Container -->
  <div id="gameContainer">
    <div id="gameBox">
      <div id="scoreBoard">Obstacles Cleared: 0</div>
      <div id="progressBar"><div id="progressFill"></div></div>
      <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>

    <!-- On mobile, the jump button is placed below the box -->
    <div id="mobileJumpWrapper">
      <button id="jumpButton">Jump</button>
    </div>
  </div>

  <!-- Popup for collisions and motivational messages -->
  <div id="popup">
    <div id="popupContent">
      <p id="popupMessage"></p>
      <button id="continueButton">Continue</button>
      <button id="restartButton" style="display:none;">Restart</button>
    </div>
  </div>

  <!-- End Credits Screen -->
  <div id="credits">
    <div id="creditsContent">
      <p>Trust me, it's something you'll like</p>
      <p>Congratulations, Prachi!</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
    </div>
  </div>

  <!-- Jump Sound -->
  <audio id="jumpSound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>

  <script>
    // Basic device detection to show jump button on mobile
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const mobileJumpWrapper = document.getElementById('mobileJumpWrapper');
    if (isMobile) {
      mobileJumpWrapper.style.display = 'block';
    }

    // DOM elements
    const instructionScreen = document.getElementById('instructionScreen');
    const startButton = document.getElementById('startButton');
    const gameContainer = document.getElementById('gameContainer');
    const gameBox = document.getElementById('gameBox');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const popup = document.getElementById('popup');
    const popupMessage = document.getElementById('popupMessage');
    const continueButton = document.getElementById('continueButton');
    const restartButton = document.getElementById('restartButton');
    const credits = document.getElementById('credits');

    const scoreBoard = document.getElementById('scoreBoard');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const jumpButton = document.getElementById('jumpButton');

    // Game variables
    let gameState = 'instructions';
    let animationId;
    let obstacles = [];
    const totalObstacles = 10;
    let currentObstacleIndex = 0;

    // Make obstacles bigger
    let obstacleWidth = 60;
    let obstacleHeight = 60;
    // Increase gap if needed so they don't cluster
    let obstacleGap = 500;

    // Player with single image
    const player = {
      x: 50,
      y: 340,    // for a 400-height canvas, ground is 400-60=340
      width: 60,
      height: 60,
      vy: 0,
      gravity: 0.5,     // lower gravity => stays in air longer
      jumpForce: -12,   // decent jump => easier to clear obstacles
      isJumping: false,
      image: new Image()
    };
    player.image.src = 'normp.png';

    // Motivational messages referencing Prachi (not corny, just direct)
    const obstacleMessages = [
      "Prachi, every step forward is a win!",
      "Keep going—no challenge can stop you!",
      "You're stronger than any hurdle!",
      "Believe in your run, Prachi!",
      "No fear: leap over doubts and obstacles!",
      "Stay focused, stay fierce!",
      "You’re braver than you think!",
      "Your spirit outshines every dark dream!",
      "Confidence grows with each jump!",
      "The finish line is all yours, Prachi!"
    ];

    // Start the game
    startButton.addEventListener('click', () => {
      instructionScreen.style.display = 'none';
      gameContainer.style.display = 'block';
      gameState = 'playing';
      createObstacles();
      updateScore(0);
      requestAnimationFrame(gameLoop);
    });

    // Create obstacles with bigger size/gap
    function createObstacles() {
      obstacles = [];
      let startX = canvas.width + 100;
      for (let i = 0; i < totalObstacles; i++) {
        obstacles.push({
          x: startX + i * obstacleGap,
          y: canvas.height - obstacleHeight, // ground
          width: obstacleWidth,
          height: obstacleHeight,
          message: obstacleMessages[i],
          passed: false
        });
      }
    }

    // Main game loop
    function gameLoop() {
      if (gameState !== 'playing') return;

      // Clear
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update
      updatePlayer();
      updateObstacles();

      // Draw
      drawPlayer();
      drawObstacles();

      animationId = requestAnimationFrame(gameLoop);
    }

    // Player updates
    function updatePlayer() {
      // Gravity
      player.y += player.vy;
      player.vy += player.gravity;

      // Floor check
      if (player.y + player.height >= canvas.height) {
        player.y = canvas.height - player.height;
        player.vy = 0;
        player.isJumping = false;
      }
    }
    function drawPlayer() {
      if (player.image.complete && player.image.naturalWidth > 0) {
        ctx.drawImage(player.image, player.x, player.y, player.width, player.height);
      } else {
        // fallback: black square
        ctx.fillStyle = '#000';
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }
    }

    // Jump
    function jump() {
      if (!player.isJumping) {
        player.vy = player.jumpForce;
        player.isJumping = true;
        // Play jump sound
        const jumpSound = document.getElementById('jumpSound');
        jumpSound.currentTime = 0;
        jumpSound.play();
      }
    }
    // Key & button events
    document.addEventListener('keydown', (e) => {
      if (gameState === 'playing' && e.code === 'Space') {
        jump();
      }
    });
    jumpButton.addEventListener('click', () => {
      if (gameState === 'playing') jump();
    });

    // Obstacles
    function updateObstacles() {
      obstacles.forEach(ob => {
        ob.x -= 4; // same speed as before, but you can tweak
      });

      if (currentObstacleIndex < obstacles.length) {
        let ob = obstacles[currentObstacleIndex];
        // Check collision
        if (isCollision(player, ob)) {
          pauseGame("You hit the obstacle!", true);
          currentObstacleIndex++;
          updateScore(currentObstacleIndex);
        }
        // Check pass
        else if (!ob.passed && ob.x + ob.width < player.x) {
          ob.passed = true;
          pauseGame(ob.message, false);
          currentObstacleIndex++;
          updateScore(currentObstacleIndex);
        }
      }
    }
    function drawObstacles() {
      ctx.fillStyle = varOrDefault('--accent', '#D4AF37');
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
        // a small "?" on them
        ctx.font = "12px Montserrat";
        ctx.fillStyle = "#333";
        ctx.fillText("?", ob.x + ob.width/2 - 3, ob.y + ob.height/2 + 4);
      });
    }

    // Collision detection
    function isCollision(a, b) {
      return (
        a.x < b.x + b.width &&
        a.x + a.width > b.x &&
        a.y < b.y + b.height &&
        a.y + a.height > b.y
      );
    }

    // Pause game & show popup
    function pauseGame(message, collided) {
      gameState = 'paused';
      cancelAnimationFrame(animationId);

      popupMessage.innerText = message;
      popup.style.display = 'flex';

      if (currentObstacleIndex >= totalObstacles) {
        // if we've cleared all obstacles, next is final
        continueButton.innerText = "Finish";
        restartButton.style.display = "none";
        continueButton.onclick = () => {
          popup.style.display = 'none';
          showCredits();
        };
      } else {
        continueButton.innerText = collided ? "Continue Anyway" : "Continue";
        restartButton.style.display = collided ? "inline-block" : "none";
        continueButton.onclick = resumeGame;
      }
    }

    function resumeGame() {
      popup.style.display = 'none';
      gameState = 'playing';
      requestAnimationFrame(gameLoop);
    }

    restartButton.addEventListener('click', () => {
      window.location.reload();
    });

    // Score & progress
    function updateScore(index) {
      if (index > totalObstacles) index = totalObstacles;
      scoreBoard.innerText = `Obstacles Cleared: ${index}`;
      const percent = Math.min((index / totalObstacles) * 100, 100);
      progressFill.style.width = percent + '%';
    }

    // Show end credits
    function showCredits() {
      gameContainer.style.display = 'none';
      credits.style.display = 'block';
    }

    // Helper to read CSS variable with fallback
    function varOrDefault(variable, fallback) {
      const val = getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
      return val === '' ? fallback : val;
    }
  </script>
</body>
</html>
