<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Prevent pinch zoom on mobile, ensure full width scale -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>run prachi run</title>
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display|Montserrat" rel="stylesheet" />
  <style>
    /* Color & Font Setup */
    :root {
      --primary: #FADCD9;   /* Muted blush pink */
      --neutral: #FFF9F4;   /* Soft cream */
      --contrast: #FFFFFF;  /* Crisp white */
      --accent: #D4AF37;    /* Subtle gold */
      --text: #111;         /* Darker text for better visibility */
    }

    html, body {
      margin: 0; 
      padding: 0;
      width: 100%; 
      height: 100%;
      background: var(--neutral);
      font-family: 'Montserrat', sans-serif;
      color: var(--text);
      overflow-x: hidden; /* No horizontal scroll */
    }

    h1, h2 {
      font-family: 'Playfair Display', serif;
      color: var(--primary);
      margin: 0;
    }

    /* Instruction Screen Overlay */
    #instructionScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: var(--neutral);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 999;
      padding: 20px;
      box-sizing: border-box;
    }
    #instructionScreen p {
      font-size: 1rem;
      margin-bottom: 20px;
      max-width: 600px;
      line-height: 1.4;
    }

    button {
      background: var(--primary);
      border: 1px solid var(--accent);
      color: var(--contrast);
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      transition: transform 0.2s ease;
    }
    button:hover {
      transform: scale(1.05);
    }

    /* Main Game Container */
    #gameContainer {
      display: none; /* shown after clicking Start */
      width: 100%;
      min-height: 100vh;
      box-sizing: border-box;
      padding-bottom: 40px; /* space for mobile jump button */
    }

    /* The box for the game, fully responsive */
    #gameBox {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      background: var(--contrast);
      border: 2px solid var(--accent);
      border-radius: 10px;
      padding: 10px;
      box-sizing: border-box;
      position: relative;
    }

    /* Score & progress bar */
    #scoreBoard {
      font-size: 1rem;
      margin: 5px 0;
    }
    #progressBar {
      width: 100%;
      height: 6px;
      background: #eee;
      border-radius: 3px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }
    #progressFill {
      width: 0%;
      height: 100%;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    /* The canvas: scaled visually to fit the box */
    #gameCanvas {
      display: block;
      width: 100%;   
      height: auto;  
      border: 1px solid #ccc;
      background: var(--neutral);
    }

    /* Mobile Jump Button: well below the box */
    #mobileJumpWrapper {
      display: none; /* shown only if mobile */
      text-align: center;
      margin-top: 30px;  /* bigger gap for thumbs */
    }
    #jumpButton {
      padding: 15px 25px;
      font-size: 1rem;
      border-radius: 8px;
    }

    /* Popup with fade-in effect */
    #popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.25s ease; /* fast but noticeable fade */
    }
    #popup.show {
      display: flex;
    }
    #popup.show.visible {
      opacity: 1;
    }

    #popupContent {
      background: var(--contrast);
      padding: 20px;
      border: 2px solid var(--primary);
      border-radius: 10px;
      text-align: center;
      max-width: 80%;
      box-sizing: border-box;
    }
    #popupContent p {
      margin-bottom: 15px;
      font-size: 1rem;
      line-height: 1.4;
    }

    /* End Credits Screen */
    #credits {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      color: #fff;
      display: none;
      overflow: hidden;
      z-index: 2000;
    }
    #creditsContent {
      position: absolute;
      width: 100%;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      line-height: 2;
      animation: scrollCredits 20s linear forwards;
      top: 100%;
    }
    @keyframes scrollCredits {
      from { top: 100%; }
      to { top: -200%; }
    }

    /* Prevent text selection while playing */
    body, #gameCanvas {
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
  </style>
</head>
<body>
  <!-- Instruction Screen -->
  <div id="instructionScreen">
    <h1>run prachi run</h1>
    <p>Prachi, it’s time to leap over every obstacle in your way. Tap “Start” and use the jump button (or spacebar on desktop) to avoid collisions. Show the world what you’ve got!</p>
    <button id="startButton">Start</button>
  </div>

  <!-- Main Game Container -->
  <div id="gameContainer">
    <div id="gameBox">
      <div id="scoreBoard">Obstacles Cleared: 0</div>
      <div id="progressBar"><div id="progressFill"></div></div>
      <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>

    <!-- On mobile, jump button sits well below the box -->
    <div id="mobileJumpWrapper">
      <button id="jumpButton">Jump</button>
    </div>
  </div>

  <!-- Popup -->
  <div id="popup">
    <div id="popupContent">
      <p id="popupMessage"></p>
      <button id="continueButton">Continue</button>
      <button id="restartButton" style="display:none;">Restart</button>
    </div>
  </div>

  <!-- End Credits Screen -->
  <div id="credits">
    <div id="creditsContent">
      <p>Trust me, it's something you'll like</p>
      <p>Congratulations, Prachi!</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
      <p>blah blah</p>
    </div>
  </div>

  <!-- Jump Sound -->
  <audio id="jumpSound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>

  <script>
    /* ========== Basic Setup ========== */
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const mobileJumpWrapper = document.getElementById('mobileJumpWrapper');
    if (isMobile) mobileJumpWrapper.style.display = 'block';

    // DOM elements
    const instructionScreen = document.getElementById('instructionScreen');
    const startButton = document.getElementById('startButton');
    const gameContainer = document.getElementById('gameContainer');
    const gameBox = document.getElementById('gameBox');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const popup = document.getElementById('popup');
    const popupContent = document.getElementById('popupContent');
    const popupMessage = document.getElementById('popupMessage');
    const continueButton = document.getElementById('continueButton');
    const restartButton = document.getElementById('restartButton');
    const credits = document.getElementById('credits');

    const scoreBoard = document.getElementById('scoreBoard');
    const progressFill = document.getElementById('progressFill');
    const jumpButton = document.getElementById('jumpButton');

    // Game variables
    let gameState = 'instructions';
    let animationId;
    const totalObstacles = 10;
    let currentObstacleIndex = 0;
    let obstacles = [];
    let gameSpeed = 4;

    // Runner image is bigger on screen, but collision box is smaller
    const drawWidth = 90;  // displayed width of runner image
    const drawHeight = 90; // displayed height of runner image

    // We'll keep a smaller bounding box for collisions
    const boundingBoxWidth = 50;
    const boundingBoxHeight = 50;

    // Player object
    const player = {
      x: 50,
      y: 400 - drawHeight, // on "ground"
      vy: 0,
      gravity: 0.5,    // stays in air a bit
      jumpForce: -12,  // decent jump
      isJumping: false,
      image: new Image(),
      boundingOffsetX: (drawWidth - boundingBoxWidth)/2,
      boundingOffsetY: (drawHeight - boundingBoxHeight)/2
    };
    player.image.src = 'normp.png';

    // Obstacle config: bigger but not too big
    const obstacleWidth = 70;
    const obstacleHeight = 70;
    const obstacleGap = 500; // bigger gap
    // Motivational messages referencing Prachi
    const obstacleMessages = [
      "Keep going, Prachi—this is your moment!",
      "No obstacle can stop your stride!",
      "Believe in every leap you take!",
      "You're unstoppable, Prachi!",
      "Confidence beats every barrier!",
      "Leap over doubts and fears!",
      "You're stronger than any hurdle!",
      "Your spirit shines past any nightmare!",
      "One jump at a time, keep pushing!",
      "The finish line is yours, Prachi!"
    ];

    /* ========== Start the Game ========== */
    startButton.addEventListener('click', () => {
      instructionScreen.style.display = 'none';
      gameContainer.style.display = 'block';
      gameState = 'playing';
      createObstacles();
      updateScore(0);
      requestAnimationFrame(gameLoop);
    });

    function createObstacles() {
      obstacles = [];
      let startX = canvas.width + 100;
      for (let i = 0; i < totalObstacles; i++) {
        obstacles.push({
          x: startX + i * obstacleGap,
          y: canvas.height - obstacleHeight,
          width: obstacleWidth,
          height: obstacleHeight,
          message: obstacleMessages[i],
          passed: false
        });
      }
    }

    /* ========== Game Loop ========== */
    function gameLoop() {
      if (gameState !== 'playing') return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      updatePlayer();
      updateObstacles();
      drawPlayer();
      drawObstacles();

      animationId = requestAnimationFrame(gameLoop);
    }

    /* ========== Player Logic ========== */
    function updatePlayer() {
      player.y += player.vy;
      player.vy += player.gravity;

      // If on ground
      if (player.y + drawHeight >= canvas.height) {
        player.y = canvas.height - drawHeight;
        player.vy = 0;
        player.isJumping = false;
      }
    }

    function drawPlayer() {
      if (player.image.complete && player.image.naturalWidth > 0) {
        ctx.drawImage(player.image, player.x, player.y, drawWidth, drawHeight);
      } else {
        // fallback: black rectangle
        ctx.fillStyle = '#000';
        ctx.fillRect(player.x, player.y, drawWidth, drawHeight);
      }
    }

    function jump() {
      if (!player.isJumping) {
        player.vy = player.jumpForce;
        player.isJumping = true;
        const jumpSound = document.getElementById('jumpSound');
        jumpSound.currentTime = 0;
        jumpSound.play();
      }
    }
    // Controls
    document.addEventListener('keydown', (e) => {
      if (gameState === 'playing' && e.code === 'Space') {
        jump();
      }
    });
    jumpButton.addEventListener('click', () => {
      if (gameState === 'playing') jump();
    });

    /* ========== Obstacle Logic ========== */
    function updateObstacles() {
      obstacles.forEach(ob => {
        ob.x -= gameSpeed;
      });

      // Check collision or pass with the next obstacle
      if (currentObstacleIndex < obstacles.length) {
        let ob = obstacles[currentObstacleIndex];
        if (isCollision(ob)) {
          // collision
          pauseGame("You hit the obstacle!", true);
          currentObstacleIndex++;
          updateScore(currentObstacleIndex);
        } 
        else if (!ob.passed && ob.x + ob.width < player.x + player.boundingOffsetX) {
          // passed
          ob.passed = true;
          pauseGame(ob.message, false);
          currentObstacleIndex++;
          updateScore(currentObstacleIndex);
        }
      }
    }

    function drawObstacles() {
      ctx.fillStyle = varOrDefault('--accent', '#D4AF37');
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
        // Mark with a "?" in the center
        ctx.font = "14px Montserrat";
        ctx.fillStyle = "#333";
        ctx.fillText("?", ob.x + ob.width/2 - 4, ob.y + ob.height/2 + 5);
      });
    }

    // Collision check using smaller bounding box for the player
    function isCollision(ob) {
      const playerHitboxX = player.x + player.boundingOffsetX;
      const playerHitboxY = player.y + player.boundingOffsetY;
      return (
        playerHitboxX < ob.x + ob.width &&
        playerHitboxX + boundingBoxWidth > ob.x &&
        playerHitboxY < ob.y + ob.height &&
        playerHitboxY + boundingBoxHeight > ob.y
      );
    }

    /* ========== Popup & Pause ========== */
    function pauseGame(msg, collided) {
      gameState = 'paused';
      cancelAnimationFrame(animationId);

      // Show popup with fade-in
      popup.classList.add('show');
      setTimeout(() => popup.classList.add('visible'), 10);

      popupMessage.innerText = msg;

      // If we've cleared all obstacles, show final
      if (currentObstacleIndex >= totalObstacles) {
        continueButton.innerText = "Finish";
        restartButton.style.display = "none";
        continueButton.onclick = () => {
          hidePopup();
          showCredits();
        };
      } else {
        continueButton.innerText = collided ? "Continue Anyway" : "Continue";
        restartButton.style.display = collided ? "inline-block" : "none";
        continueButton.onclick = resumeGame;
      }
    }

    function resumeGame() {
      hidePopup();
      gameState = 'playing';
      requestAnimationFrame(gameLoop);
    }

    function hidePopup() {
      popup.classList.remove('visible');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 250); // matches transition
    }

    restartButton.addEventListener('click', () => {
      window.location.reload();
    });

    /* ========== Score & Progress ========== */
    function updateScore(index) {
      if (index > totalObstacles) index = totalObstacles;
      scoreBoard.innerText = `Obstacles Cleared: ${index}`;
      const percent = Math.min((index / totalObstacles) * 100, 100);
      progressFill.style.width = percent + '%';
    }

    /* ========== End Credits ========== */
    function showCredits() {
      gameContainer.style.display = 'none';
      credits.style.display = 'block';
    }

    /* Helper to read CSS variable with fallback */
    function varOrDefault(variable, fallback) {
      const val = getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
      return val === '' ? fallback : val;
    }
  </script>
</body>
</html>
